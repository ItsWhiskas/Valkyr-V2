/*
 * This build file was generated by the Gradle 'init' task.
 *
 * This generated file contains a commented-out sample Java project to get you started.
 * For more details take a look at the Java Quickstart chapter in the Gradle
 * user guide available at https://docs.gradle.org/4.3/userguide/tutorial_java_projects.html
 */

buildscript {
    repositories {
        mavenLocal()
        mavenCentral()
        jcenter()
        maven { url "https://oss.sonatype.org/content/repositories/snapshots" }
    }
    dependencies {
        // provides proguard.gradle.ProGuardTask (including all requirements)
        classpath 'net.sf.proguard:proguard-gradle:6.0.2'
    }
}

apply plugin: 'java'

sourceCompatibility = JavaVersion.VERSION_1_8
targetCompatibility = JavaVersion.VERSION_1_8

// *** IMPORTANT ***
// Old RSPS projects often use Windows-1252/Latin-1 for source files.
// This stops "unmappable character for encoding UTF8" errors on Whirlpool.java, etc.
tasks.withType(JavaCompile) {
    options.encoding = 'windows-1252'   // or 'ISO-8859-1' if you prefer
}

// Where to find dependencies
repositories {
    mavenCentral()
    mavenLocal()
    jcenter()
}

// Dependencies
dependencies {
    implementation group: 'com.google.code.gson',        name: 'gson',        version: '2.8.5'
    implementation group: 'com.googlecode.json-simple',  name: 'json-simple', version: '1.1.1'
    implementation group: 'org.slf4j',                   name: 'slf4j-api',   version: '1.7.25'
    implementation group: 'com.google.guava',            name: 'guava',       version: '27.0.1-jre'
    implementation group: 'org.apache.ant',              name: 'ant',         version: '1.9.4'

    compileOnly   group: 'org.projectlombok',            name: 'lombok',      version: '1.18.42'
    annotationProcessor 'org.projectlombok:lombok:1.18.42'


    testImplementation 'junit:junit:4.12'
}

// Jar task
jar {
    archiveFileName = "suite-base.jar"

    manifest {
        attributes(
                'Main-Class': 'Main',
        )
    }

    // Gradle 7+ has no 'compile' configuration; use runtimeClasspath instead
    from {
        configurations.runtimeClasspath.collect { file ->
            file.isDirectory() ? file : zipTree(file).matching {
                exclude { it.name.contains('MANIFEST.MF') }
            }
        }
    }
}

// ProGuard task
task myProguardTask(type: proguard.gradle.ProGuardTask) {

    configuration 'proguard.conf'

    // Gradle 7+ has no 'runtime' configuration; use runtimeClasspath instead
    configurations.runtimeClasspath.resolve().each { dep ->
        libraryjars file(dep.getAbsolutePath())
    }

    // Use the jar we just built
    injars 'build/libs/suite-base.jar'
    outjars 'build/dist/deploy/Valkyr_Cache_Suite.jar'
}

jar.finalizedBy(myProguardTask)
